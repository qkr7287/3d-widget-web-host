# 위젯 제공 방식 비교: 같은 서버(통합) vs 분리(CDN/원격 import)

이 문서는 3D 위젯을

- **호스트와 같은 서버/오리진에서 제공(통합)** 하는 방식과,
- **위젯을 분리해 CDN(또는 다른 서버)에서 원격 ESM으로 import(분리)** 하는 방식

을 성능/운영 관점에서 비교합니다.

## 한 줄 요약

- **통합(같은 서버)**: 구조가 단순하고 운영 난이도가 낮지만, 배포 결합도가 높습니다.
- **분리(CDN/원격)**: 재사용/독립 배포/캐시 최적화에 유리하지만, CORS/CSP/버전 관리 부담이 생깁니다.

## 비교 표(추천)

| 항목 | 통합(같은 서버/같은 오리진) | 분리(CDN/다른 서버에서 원격 import) |
|---|---|---|
| 초기 로딩(첫 방문) | 대체로 단순(요청 경로 짧음) | 원격 import + 추가 요청으로 느려질 수 있음 |
| 재방문/다른 서비스 재사용 | 서비스가 다르면 캐시 재사용이 제한적 | 동일 위젯 URL 재사용 시 캐시 이점 큼 |
| 배포 결합도 | 호스트+위젯이 함께 배포되는 경우가 많음 | 위젯만 독립 배포/롤백 가능 |
| 운영 설정 난이도 | 낮음(CORS 거의 X) | 높음(CORS/CSP 필수) |
| 버전/호환성 | 한 번들 내에서 함께 맞추기 쉬움 | 계약(API) 관리 필요(버전 핀/호환 정책 필요) |
| 번들/다운로드 용량 | 공통 라이브러리 공유로 줄어들 수 있음 | 중복 포함 시 총 다운로드량 증가 가능 |
| 장애 전파 | 단일 서비스 안에서 통제 | CDN/네트워크 장애가 호스트 기능에 영향 가능(폴백 고려) |
| 팀/조직 확장성 | 릴리즈 조율 비용이 커질 수 있음 | 팀 분리/독립 개발·배포에 유리 |

## 장점/단점 요약

### 통합(같은 서버/같은 오리진)

**장점**

- 초기 로딩 경로가 단순해서 안정적
- CORS/CSP 설정 부담이 낮음
- 공통 라이브러리 중복이 줄어 총 다운로드가 감소할 수 있음
- 디버깅/관측(로그/소스맵/버전)이 한 곳에 모임

**단점**

- 위젯만 바꿔도 호스트 배포가 필요해질 수 있음(배포 결합도↑)
- 여러 서비스/도메인에 재사용하려면 복제/동기화 비용↑

### 분리(CDN/원격 import)

**장점**

- 위젯 독립 배포/롤백 가능(호스트와 릴리즈 분리)
- 여러 서비스에서 같은 위젯 URL을 쓰면 캐시 재사용으로 유리
- CDN 최적화(엣지 캐시, Brotli, HTTP/2/3, 캐시 헤더) 활용 가능
- 위젯 팀/호스트 팀이 독립적으로 개발·배포 가능

**단점**

- CORS/CSP 등 운영 설정 난이도 상승(실제 장애 원인이 되기 쉬움)
- 호스트-위젯 API 계약 관리 필요(호환성/버전 핀)
- 중복 번들로 총 다운로드량이 늘 수 있음
- 위젯 서버/CDN 장애나 네트워크 이슈가 호스트 기능에 직접 영향 → 폴백 UX 필요

## 선택 가이드(간단)

- 위젯이 **한 서비스/한 페이지 중심**이고 “단순함”이 최우선이면 → **통합**
- 위젯을 **여러 서비스에 재사용**하고 “독립 배포”가 필요하면 → **분리(CDN)**

## 분리 방식 운영 체크리스트

- **CORS**: 위젯 서버가 `Access-Control-Allow-Origin`을 정확히 내려주는가?
- **CSP**: 호스트의 `script-src`가 위젯 도메인을 허용하는가?
- **버전/캐시**: 위젯 URL을 버전 경로(`/v1/embed.js`) 또는 쿼리(`?v=...`)로 핀할 수 있는가?
- **장애/폴백**: 위젯 로딩 실패 시 사용자에게 어떤 UX를 보여줄 것인가?

